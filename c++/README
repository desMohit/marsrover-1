C++ port of the solution.
